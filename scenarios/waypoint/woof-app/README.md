# 🐶 Woof App - Waypoint

## Introduction

Woof App utilizes **Istio Waypoint**, a concept introduced in **Istio Ambient Mesh**, which provides a **lightweight and efficient alternative** to the traditional sidecar-based service mesh.

Waypoints act as **per-service proxies** that offer **Layer 7 (L7) capabilities** such as **authorization, telemetry, and policy enforcement**—all without requiring a sidecar on every workload.

---

## 🚀 Deployment Steps

### 1️⃣ Install Gateway API

Ambient mesh is configured using the Gateway API. The APIs are not installed by default on most clusters, so install the latest version:

[Gateway API Documentation](https://gateway-api.sigs.k8s.io/)

```sh
kubectl get crd gateways.gateway.networking.k8s.io &> /dev/null || \
  { kubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.2.0/standard-install.yaml }
```

### 2️⃣ Create the Namespace

First, create the **namespace** and enable **Istio Ambient Mode**:

```sh
kubectl create -f namespace.yaml
kubectl label ns woof istio.io/dataplane-mode=ambient
```

### 3️⃣ Create a Waypoint in the `woof` Namespace

You can create a **waypoint** in two different ways:

#### Option 1: Using `istioctl`
```sh
istioctl waypoint generate --for service -n woof | kubectl apply -f -
```

#### Option 2: Using a YAML Manifest
```sh
kubectl apply -f gateway.yaml
```

### 4️⃣ Label the Namespace to Use the Waypoint

```sh
kubectl label ns woof istio.io/use-waypoint=waypoint
```

### 5️⃣ Deploy the Woof App and Services

```sh
kubectl apply -f woof-app.yaml -f woof-service.yaml
```

### 6️⃣ Create HTTP Routes

```sh
kubectl apply -f http-route.yaml
```

### 7️⃣  Create a pod to access the service

To test the newly configured routes, deploy a **test pod**:

```sh
kubectl apply -f curl-app.yaml
```

### 8️⃣ Test the service

To test the configured routes, use the following command:

```sh
kubectl -n woof exec curl-app -- curl -si http://woof-service/woof

HTTP/1.1 200 OK
x-powered-by: Express
content-type: text/html; charset=utf-8
content-length: 372
etag: W/"174-6cIdZu9aSGFZ9mrOD61cEyyKrNk"
date: Wed, 19 Feb 2025 19:59:21 GMT
x-envoy-upstream-service-time: 0
server: istio-envoy
x-envoy-decorator-operation: woof-route-0-istio-autogenerated-k8s-gateway:80/*

       .--.             .---.
        /:.  '.         .' ..  '._.---.
       /:::-.  \.-"""-; .-:::.     .::\
      /::'|  \/  _ _  \'   \:'   ::::|
  __.'    |   /  (o|o)  \     '.   ':/ 
 /    .:. /   |   ___   |        '---'
|    ::::'   /:  (._.) .:\
\    .='    |:'        :::|
 ""       \     .-.   ':/ 
             '---|I|---'
                  '-'


        woof woof v1
```

---

Your **Woof App** is now deployed with **Istio Ambient Mesh** and **Waypoint proxying** enabled.

You can visualize your service mesh using the Kiali dashboard, which provides real-time insights into service interactions, traffic flow, and performance metrics.

To access Kiali, start port forwarding by running the following command:
```
kubectl port-forward --namespace istio-system svc/kiali 3000:20001 &> /dev/null &
```
Once the command executes, open your browser and navigate to `http://localhost:3000` to explore the Kiali dashboard.

